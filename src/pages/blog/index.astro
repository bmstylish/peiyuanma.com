---
import { getCollection } from 'astro:content';
import BaseLayout from '@/layouts/BaseLayout.astro';
import BlogPostCard from '@/components/BlogPostCard.astro';

const allPosts = await getCollection('blog');
const posts = allPosts
  .filter(post => !post.data.draft)
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf());

const allTags = [...new Set(posts.flatMap(post => post.data.tags))].sort();
---

<BaseLayout 
  title="Blog â€¢ Peiyuan Ma"
  description="Technical writeups, security analysis, and research notes"
>
  <h1>Blog</h1>
  <p class="page-intro">
    Technical writeups, incident analysis, and security research notes. 
    Focused on practical defensive security and detection engineering.
  </p>

  <div class="tags-filter">
    <span class="filter-label">Tags:</span>
    {allTags.map(tag => (
      <span class="tag">{tag}</span>
    ))}
  </div>

  <div class="posts-list">
    {posts.map(post => (
      <BlogPostCard 
        title={post.data.title}
        description={post.data.description}
        date={post.data.date}
        tags={post.data.tags}
        slug={post.id}
      />
    ))}
  </div>
</BaseLayout>

<style>
  .page-intro {
    font-size: 1.0625rem;
    color: var(--color-text-muted);
    margin-bottom: calc(var(--spacing-unit) * 4);
  }
  
  .tags-filter {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: calc(var(--spacing-unit) * 1);
    margin-bottom: calc(var(--spacing-unit) * 6);
    padding: calc(var(--spacing-unit) * 3);
    background: var(--color-surface);
    border: 1px solid var(--color-border);
    border-radius: var(--radius);
  }
  
  .filter-label {
    font-size: 0.875rem;
    color: var(--color-text-muted);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
  }
  
  .posts-list {
    display: flex;
    flex-direction: column;
    gap: calc(var(--spacing-unit) * 3);
  }
</style>
